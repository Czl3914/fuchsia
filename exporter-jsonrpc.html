<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="generator" content="Asciidoctor 0.1.3">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Export JSONRPC</title>
<link rel="stylesheet" href="./stylesheets/asciidoc.css">
</head>
<body class="article">
<div id="header">
</div>
<div id="content">
<div class="sect2">
<h3 id="_export_jsonrpc">Export JSONRPC</h3>
<div class="sect3">
<h4 id="_goal">Goal</h4>
<div class="paragraph">
<p>Expose an OSGi service instance as a JSONRPC service that can be accessed remotely through a URL.</p>
</div>
</div>
<div class="sect3">
<h4 id="_requirements">Requirements</h4>
<div class="ulist">
<ul>
<li>
<p>service instance that will be exporter</p>
</li>
<li>
<p>declaration containing the metadata below:</p>
<div class="ulist">
<ul>
<li>
<p><strong>fuchsia.export.jsonrpc.class</strong> - full name of the interface in which your instance implements. e.g. /org.ow2.chameleon.fuchsia.jsonrpc.exporter.experiment.DummyIface/</p>
</li>
<li>
<p><strong>fuchsia.export.jsonrpc.instance</strong> - instance.name (in OSGi terms) of your service, which will be used to grab the proper instance to be exported. e.g. DummyPojoInstance</p>
</li>
<li>
<p><strong>fuchsia.export.jsonrpc.url.context</strong> (optional) - indicated the context that will be added in URL, by default "JSONRPC", which will be used as a prefix in the URL for the instance as in the example: <strong><a href="http://localhost:8080/JSONRPC/DummyPojoInstance">http://localhost:8080/JSONRPC/DummyPojoInstance</a></strong></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_example">Example</h4>
<div class="sect4">
<h5 id="_exporter_instantiation">Exporter instantiation</h5>
<div class="listingblock">
<div class="content monospaced">
<pre class="highlight"><code class="java language-java">       Instance jsonRPCExporter = instance()
                .of("org.ow2.chameleon.fuchsia.exporter.jsonrpc.JSONRPCExporter")
                .with("target").setto("(fuchsia.export.jsonrpc.instance=*)");</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_linker_instantiation">Linker instantiation</h5>
<div class="listingblock">
<div class="content monospaced">
<pre class="highlight"><code class="java language-java">        Instance jsonRPCExporterLinker = instance()
            .of(FuchsiaConstants.DEFAULT_EXPORTATION_LINKER_FACTORY_NAME)
            .with(ExportationLinker.FILTER_EXPORTDECLARATION_PROPERTY).setto("(fuchsia.export.jsonrpc.instance=*)")
            .with(ExportationLinker.FILTER_EXPORTERSERVICE_PROPERTY).setto("(instance.name=jsonRPCExporter)");</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_export_declaration_instantiation">Export Declaration instantiation</h5>
<div class="listingblock">
<div class="content monospaced">
<pre class="highlight"><code class="java language-java">
        Map&lt;String, Object&gt; metadata=new HashMap&lt;String, Object&gt;();

        metadata.put("id","exporter-1");
        metadata.put("fuchsia.export.jsonrpc.class","org.ow2.chameleon.fuchsia.jsonrpc.exporter.experiment.DummyIface");
        metadata.put("fuchsia.export.jsonrpc.instance","DummyPojoInstance");

        ExportDeclaration declaration = ExportDeclarationBuilder.fromMetadata(metadata).build();

        Dictionary&lt;String, Object&gt; props = new Hashtable&lt;String, Object&gt;();

        String clazzes[] = new String[]{org.ow2.chameleon.fuchsia.core.declaration.ExportDeclaration.class.getName()};
        ServiceRegistration registration = context.registerService(clazzes, declaration, props);
</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_verification">Verification</h4>
<div class="sect4">
<h5 id="_service_was_properly_exported">Service was properly exported</h5>
<div class="paragraph">
<p>You can use <a href="http://fr.wikipedia.org/wiki/CURL">cURL</a> to test if your instance was properly exported.</p>
</div>
<div class="listingblock">
<div class="content monospaced">
<pre class="highlight"><code class="xml language-xml">linux-shell# curl -i -X POST -d '{"jsonrpc": "2.0", "method": "helloworld", "params": ["earth"], "id": 1}' http://localhost:8080/JSONRPC/DummyPojoInstance</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>helloworld</strong> should be replaced by the method name declared on your interface to be exported</p>
</div>
<div class="paragraph">
<p><strong>earth</strong> will be replaced by the parameters requested by your interface</p>
</div>
<div class="paragraph">
<p><strong><a href="http://localhost:8080/JSONRPC/DummyPojoInstance">http://localhost:8080/JSONRPC/DummyPojoInstance</a></strong>, consider this example an instance of the pattern "http://A:B/C/D", A and B depend on your framework configuration; C is constant and will never change; D is in fact the same "instance.name" of your OSGi service instance;</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2014-02-14 10:36:51 CET
</div>
</div>
</body>
</html>