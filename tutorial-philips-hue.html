<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="generator" content="Asciidoctor 0.1.4">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Philips hue in Fuchsia</title>
<style>
</style>
</head>
<body class="article">
<div id="header">
</div>
<div id="content">
<div class="sect2">
<h3 id="_philips_hue_in_fuchsia">Philips hue in Fuchsia</h3>
<div class="sect3">
<h4 id="_description">Description</h4>
<div class="paragraph">
<p>We are ready to use Philips Hue, simply by:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>deploying a philips hue discovery - detects the presense of a Philips Hue bridge and authenticates on it.</p>
</li>
<li>
<p>deploying a philips hue importer - makes the lamp accessible by OSGi</p>
</li>
<li>
<p>configure a linker between the discovery and importer</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>And at each step you can verify that they were correctly deployed, this is the biggest advantage of using Fuchsia as a device framework.</p>
</div>
</div>
<div class="sect3">
<h4 id="_building_the_platform">Building the platform</h4>
<div class="paragraph">
<p>In order to build the platform you are going to download the <a href="https://github.com/ow2-chameleon/fuchsia/">source code</a>. Then you need two other steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>mvn clean install #compiles the project</p>
</li>
<li>
<p>mvn -f distribution/pom.xml clean install -Pcore,discovery-philips-hue,importer-philips-hue #creates a distribution with all philips base code</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The only thing left to do is to start your platform, on directory <em>distribution/target/chameleon-distribution</em> launch the application:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>sh chameleon.sh --interactive</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>That is it, at this point you have all the platform running, now you need to declare your <strong>intentions</strong>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_declaring_intentions">Declaring intentions</h4>
<div class="paragraph">
<p>This is done by java code, you have to deploy a bundle in the platform that creates the intentions, which is basically instantiate the components: discovery, importer and the linkers. This can be done with the code below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>@Configuration
public class Config {

    Instance philipsBridgeImporter = instance()
            .of("org.ow2.chameleon.fuchsia.importer.philipshue.PhilipsHueBridgeImporter");

    Instance philipsImporter = instance()
            .of("org.ow2.chameleon.fuchsia.importer.philipshue.PhilipsHueImporter");

    Instance philipsLinkerBridge = instance()
            .of(FuchsiaConstants.DEFAULT_IMPORTATION_LINKER_FACTORY_NAME)
            .with(ImportationLinker.FILTER_IMPORTDECLARATION_PROPERTY).setto("(discovery.philips.bridge.type=*)")
            .with(ImportationLinker.FILTER_IMPORTERSERVICE_PROPERTY).setto("(instance.name=philipsBridgeImporter)");

    Instance philipsLinker = instance()
            .of(FuchsiaConstants.DEFAULT_IMPORTATION_LINKER_FACTORY_NAME)
            .with(ImportationLinker.FILTER_IMPORTDECLARATION_PROPERTY).setto("(discovery.philips.device.name=*)")
            .with(ImportationLinker.FILTER_IMPORTERSERVICE_PROPERTY).setto("(instance.name=philipsImporter)");

}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_check_if_everything_is_working">Check if everything is working</h4>
<div class="paragraph">
<p>On the shell you can type the command below, and you should obtain the list of all installed importers</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>user@shelbie$ importer
        ._____________________________________________
        |name:philipsImporter
        |bundle:org.ow2.chameleon.fuchsia.importer.philips-hue[17]
        |importer name = PhilipsHueImporter
        |          ._____________________________________________
        |          |factory.name = org.ow2.chameleon.fuchsia.importer.philipshue.PhilipsHueImporter
Importer|          |instance.name = philipsImporter
        |Properties|objectClass = [Ljava.lang.String;@1e10aef
        |          |service.id = 317
        |          |target = (discovery.philips.device.name=*)
        |          |_____________________________________________
        |_____________________________________________
        ._____________________________________________
        |name:philipsBridgeImporter
        |bundle:org.ow2.chameleon.fuchsia.importer.philips-hue[17]
        |importer name = PhilipsHueBridgeImporter
        |          ._____________________________________________
        |          |factory.name = org.ow2.chameleon.fuchsia.importer.philipshue.PhilipsHueBridgeImporter
Importer|          |instance.name = philipsBridgeImporter
        |Properties|objectClass = [Ljava.lang.String;@194ef9f
        |          |service.id = 315
        |          |target = (discovery.philips.bridge.type=*)
        |          |_____________________________________________
        |_____________________________________________

user@shelbie$</code></pre>
</div>
</div>
<div class="paragraph">
<p>After we can check is our linkers are all in place:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>user@shelbie$ linker
                  ._____________________________________________
                  |name:philipsLinker
                  |bundle:org.ow2.chameleon.fuchsia.core[21]
                  |          ._____________________________________________
                  |          |factory.name = FuchsiaDefaultImportationLinkerFactory
                  |          |fuchsia.linker.filter.importDeclaration = (discovery.philips.device.name=*)
Importation Linker|          |fuchsia.linker.filter.importerService = (instance.name=philipsImporter)
                  |Properties|instance.name = philipsLinker
                  |          |objectClass = [Ljava.lang.String;@3e1a61
                  |          |service.id = 323
                  |          |_____________________________________________
                  |_____________________________________________
                  ._____________________________________________
                  |name:philipsLinkerBridge
                  |bundle:org.ow2.chameleon.fuchsia.core[21]
                  |          ._____________________________________________
                  |          |factory.name = FuchsiaDefaultImportationLinkerFactory
                  |          |fuchsia.linker.filter.importDeclaration = (discovery.philips.bridge.type=*)
Importation Linker|          |fuchsia.linker.filter.importerService = (instance.name=philipsBridgeImporter)
                  |Properties|instance.name = philipsLinkerBridge
                  |          |objectClass = [Ljava.lang.String;@1361707
                  |          |service.id = 321
                  |          |_____________________________________________
                  |_____________________________________________

user@shelbie$</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_testing_your_philipshue">Testing your PhilipsHue</h4>
<div class="paragraph">
<p>There are two commands to manipulate and verify the actual state of the lamp, they are: <strong>phlist</strong> and <strong>phset</strong></p>
</div>
<div class="paragraph">
<p>If your lamp was corrected detected, just type <em>phlist</em> (as below) and you should get the list of the philips light that are available along with their state.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>user@shelbie$ phlist</code></pre>
</div>
</div>
<div class="paragraph">
<p>In case you wanna change its color (in fact change the color of all lamps) you can use the command <em>phset</em> as below to set the color to red:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>user@shelbie$ phset -on true -r 255</code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2014-04-04 15:01:09 CEST
</div>
</div>
</body>
</html>